# 乳児うつ伏せ検知デバイス TODO

## 1. 優先度 高

- [x] T-001 `main/main.c` に Wi-Fi STA 初期化を実装する。完了条件: 固定 SSID/PASSWORD で接続成功ログが出る。
- [x] T-002 HTTP サーバを実装し `GET /` を返す。完了条件: ブラウザで HTML が表示される。
- [x] T-003 `GET /stream` の MJPEG 配信を実装する。完了条件: 320x240 映像が連続更新される。
- [x] T-004 ESP-DL 推論の最小呼び出しを実装する。完了条件: フレームごとに `is_face_detected` と `confidence` を取得できる。
- [x] T-005 うつ伏せ継続判定を実装する。完了条件: 10 秒継続で `ALERT` 状態に遷移する。
- [x] T-006 赤枠描画を実装する。完了条件: 顔検知成立時に対象領域へ赤枠が重畳される。

## 2. 優先度 中

- [x] T-007 `GET /health` を実装する。完了条件: `state`、`wifi`、`camera`、`inference` を JSON で返す。
- [ ] T-008 Wi-Fi 再接続処理を実装する。完了条件: 切断後 60 秒以内に配信復帰する。
- [ ] T-009 カメラ再初期化処理を実装する。完了条件: 初期化失敗時に 5 秒間隔で再試行する。
- [ ] T-010 推論失敗時の劣化運転を実装する。完了条件: 赤枠なし配信を継続できる。

## 3. 優先度 低

- [ ] T-011 ログ整備を行う。完了条件: 状態遷移と障害回数を `INFO/WARN/ERROR` で追跡できる。
- [ ] T-012 しきい値を `sdkconfig` へ外出しする。完了条件: 再ビルドで閾値変更を反映できる。

## 4. 検証タスク

- [ ] V-001 起動から 30 秒以内に Wi-Fi 接続できることを確認する。
- [ ] V-002 `/stream` の 10 分連続表示でフリーズしないことを確認する。
- [ ] V-003 顔検知成立時に赤枠表示になることを確認する。
- [ ] V-004 非うつ伏せ 10 分で誤赤枠が 1 回以下であることを確認する。
- [ ] V-005 Wi-Fi 切断と再接続で自動復帰することを確認する。

## 5. 未解決事項

- [ ] U-001 ESP-DL で採用するモデル形式と入力サイズ。判断者: 開発担当。期限: T-004 着手前。
- [ ] U-002 Freenove カメラピン定義の最終確定。判断者: 開発担当。期限: T-003 着手前。
- [x] U-003 赤枠描画方式の確定（JPEG 展開後描画か YUV 描画か）。判断者: 開発担当。期限: T-006 着手前。

## 6. リスク

- [ ] R-001 推論負荷により配信 FPS が低下する。緩和策: 推論間隔を 500ms 固定で開始し段階調整。
- [ ] R-002 ハードコード資格情報の漏えい。緩和策: ログ出力禁止と公開前の秘匿化ルール徹底。
- [ ] R-003 照度不足で誤検知が増える。緩和策: 設置条件と評価データをドキュメント化する。
